# Work Breakdown: Documentation System

Spec: [ADR-003: Documentation Architecture](./decisions/ADR-003-documentation-architecture.md)
Created: 2025-01-22
Architect: @architect

## Overview

Implement automated documentation pipeline with TypeDoc, enhanced CLAUDE.txt generation, search integration, and versioning support. Architecture decision: stay with custom Next.js, enhance with automation.

## Shared Interfaces (Define First)

These types/contracts MUST be created before parallel work begins.

### Interface 1: Documentation Types

```typescript
// File: apps/developers/src/types/docs.ts
// Owner: Build Agent 1 (do first, others depend on this)

export interface DocPage {
  slug: string;
  title: string;
  description: string;
  content: string;
  section: "guides" | "api" | "reference";
  order: number;
  editUrl: string;
  lastModified: Date;
}

export interface ApiDoc {
  name: string;
  kind: "class" | "interface" | "function" | "type";
  description: string;
  signature: string;
  parameters?: Parameter[];
  returns?: string;
  examples?: string[];
  sourceFile: string;
  sourceLine: number;
}

export interface Parameter {
  name: string;
  type: string;
  description: string;
  optional: boolean;
  default?: string;
}

export interface SearchResult {
  title: string;
  url: string;
  description: string;
  section: string;
  snippet: string;
}

export interface DocsConfig {
  version: string;
  versions: string[];
  defaultVersion: string;
  editBaseUrl: string;
  algoliaAppId?: string;
  algoliaApiKey?: string;
}
```

## Work Units

### WU-0: Shared Types and Configuration

**Owner:** Build Agent 1 (do first)
**Depends on:** None
**Files (exclusive):**

- `apps/developers/src/types/docs.ts` (create)
- `typedoc.json` (create)
- `scripts/docs/config.ts` (create)

**Files (read-only):**

- `packages/sdk/src/types.ts`
- `packages/sdk/src/index.ts`

**Deliverable:** TypeScript types for docs system, TypeDoc configuration
**Tests:** Type compilation check

---

### WU-1: TypeDoc API Generation Pipeline

**Owner:** Build Agent 2
**Depends on:** WU-0 (needs types)
**Files (exclusive):**

- `scripts/docs/generate-api-docs.ts` (create)
- `scripts/docs/typedoc-transform.ts` (create)
- `docs/api/` (create directory)
- `docs/api/.gitignore` (create - ignore generated files)

**Files (read-only):**

- `packages/sdk/src/**/*.ts`
- `packages/sdk-react/src/**/*.ts`
- `typedoc.json`
- `apps/developers/src/types/docs.ts`

**Deliverable:**

- Script that runs TypeDoc and transforms output to JSON/MDX
- Generated API documentation files
- CI-ready pipeline

**Tests:** `scripts/docs/__tests__/generate-api-docs.test.ts`

---

### WU-2: CLAUDE.txt Auto-Generation

**Owner:** Build Agent 3
**Depends on:** WU-0 (needs types)
**Files (exclusive):**

- `scripts/docs/generate-claude-txt.ts` (create)
- `scripts/docs/extract-exports.ts` (create)
- `packages/sdk/CLAUDE.txt` (modify - now generated)
- `apps/developers/public/CLAUDE.txt` (modify - now generated)

**Files (read-only):**

- `packages/sdk/src/**/*.ts`
- `packages/sdk-react/src/**/*.ts`
- `apps/developers/src/types/docs.ts`

**Deliverable:**

- Script that parses TypeScript AST and generates CLAUDE.txt
- Enhanced CLAUDE.txt (200+ lines from current 79)
- Includes all exported types, methods, and examples

**Tests:** `scripts/docs/__tests__/generate-claude-txt.test.ts`

---

### WU-3: API Reference Pages in Developers App

**Owner:** Build Agent 4
**Depends on:** WU-0 (needs types), WU-1 (needs generated docs)
**Files (exclusive):**

- `apps/developers/src/app/api/page.tsx` (create)
- `apps/developers/src/app/api/[...slug]/page.tsx` (create)
- `apps/developers/src/components/ApiReference.tsx` (create)
- `apps/developers/src/components/TypeSignature.tsx` (create)
- `apps/developers/src/lib/docs.ts` (create)

**Files (read-only):**

- `apps/developers/src/types/docs.ts`
- `docs/api/**/*.json` (generated by WU-1)

**Deliverable:**

- Dynamic API reference pages
- Type signature rendering component
- Navigation for API docs

**Tests:** E2E test for API pages

---

### WU-4: Search Integration (Algolia DocSearch)

**Owner:** Build Agent 5
**Depends on:** WU-0 (needs types)
**Files (exclusive):**

- `apps/developers/src/components/Search.tsx` (create)
- `apps/developers/src/components/SearchModal.tsx` (create)
- `apps/developers/src/app/layout.tsx` (modify - add search)
- `apps/developers/src/lib/search.ts` (create)
- `.env.example` (modify - add Algolia keys)

**Files (read-only):**

- `apps/developers/src/types/docs.ts`

**Deliverable:**

- Search component with Algolia DocSearch
- Keyboard shortcut (Cmd+K)
- Fallback local search if Algolia unavailable

**Tests:** `apps/developers/src/components/__tests__/Search.test.tsx`

---

### WU-5: Version Selector Component

**Owner:** Build Agent 6
**Depends on:** WU-0 (needs types)
**Files (exclusive):**

- `apps/developers/src/components/VersionSelector.tsx` (create)
- `apps/developers/src/components/Header.tsx` (modify - add version)
- `apps/developers/src/lib/versions.ts` (create)
- `apps/developers/next.config.js` (modify - add rewrites)

**Files (read-only):**

- `apps/developers/src/types/docs.ts`
- `packages/sdk/package.json` (read version)

**Deliverable:**

- Version dropdown in header
- URL-based version routing (/v0.13/, /v0.14/)
- Current version auto-detection

**Tests:** `apps/developers/src/components/__tests__/VersionSelector.test.tsx`

---

### WU-6: Edit on GitHub Links

**Owner:** Build Agent 7
**Depends on:** WU-0 (needs types)
**Files (exclusive):**

- `apps/developers/src/components/EditOnGitHub.tsx` (create)
- `apps/developers/src/components/DocFooter.tsx` (create)

**Files (read-only):**

- `apps/developers/src/types/docs.ts`

**Deliverable:**

- "Edit this page on GitHub" link component
- Doc page footer with edit link and last modified

**Tests:** Unit test for URL generation

---

### WU-7: CI/CD Pipeline for Documentation

**Owner:** Build Agent 8
**Depends on:** WU-1, WU-2 (needs generation scripts)
**Files (exclusive):**

- `.github/workflows/docs.yml` (create)
- `scripts/docs/build-all.ts` (create)

**Files (read-only):**

- `scripts/docs/generate-api-docs.ts`
- `scripts/docs/generate-claude-txt.ts`
- `apps/developers/package.json`

**Deliverable:**

- GitHub Actions workflow for doc generation
- Automated deployment on SDK changes
- CLAUDE.txt sync on every release

**Tests:** Workflow dry-run

---

### WU-8: Content Migration and Guides

**Owner:** Build Agent 9
**Depends on:** WU-3 (needs doc infrastructure)
**Files (exclusive):**

- `docs/guides/react.md` (create)
- `docs/guides/nextjs.md` (create)
- `docs/guides/vanilla.md` (create)
- `docs/guides/testing.md` (create)
- `docs/guides/migration-from-nextauth.md` (create)
- `apps/developers/src/app/guides/page.tsx` (create)
- `apps/developers/src/app/guides/[slug]/page.tsx` (create)

**Files (read-only):**

- `packages/sdk/README.md`
- `apps/developers/src/types/docs.ts`

**Deliverable:**

- Framework-specific guides
- Migration guide from NextAuth
- Testing documentation

**Tests:** Content validation, link checking

---

### WU-9: Integration Testing

**Owner:** Build Agent 10
**Depends on:** WU-1, WU-2, WU-3, WU-4, WU-5, WU-6, WU-7, WU-8
**Files (exclusive):**

- `apps/developers/tests/e2e/docs.spec.ts` (create)
- `apps/developers/tests/e2e/search.spec.ts` (create)
- `apps/developers/tests/e2e/api-reference.spec.ts` (create)

**Files (read-only):**

- All files from WU-1 through WU-8

**Deliverable:**

- E2E tests for documentation system
- Search functionality tests
- API reference rendering tests
- Version switching tests

**Tests:** Playwright E2E suite

---

## Dependency Graph

```
WU-0 (Types/Config)
    │
    ├────────┬────────┬────────┬────────┬────────┐
    │        │        │        │        │        │
    ▼        ▼        ▼        ▼        ▼        ▼
  WU-1     WU-2     WU-4     WU-5     WU-6     WU-7
(TypeDoc) (CLAUDE) (Search) (Version) (Edit)  (CI/CD)
    │        │                                   │
    │        │                                   │
    ▼        ▼                                   │
  WU-3 ◄────────────────────────────────────────┘
(API Pages)
    │
    ▼
  WU-8
(Guides)
    │
    ▼
  WU-9
(Integration Tests)
```

## Coordination Protocol

### File Ownership Rules

1. **Exclusive files** - Only the assigned agent may edit
2. **Read-only files** - Any agent may import, none may edit
3. **Shared types** - Created in WU-0, read-only thereafter
4. **Generated files** - Scripts own, consumers read

### Generated File Handling

Files in `docs/api/` are generated by WU-1:

- Not committed to git (in .gitignore)
- Regenerated on every build
- Consumed by WU-3 at build time

### Communication

Agents signal completion via commit messages:

- `feat(WU-1): Add TypeDoc API generation pipeline`
- `feat(WU-2): Auto-generate CLAUDE.txt from TypeScript`

Next agent waits for dependent WU commits before starting.

## Parallel Execution Plan

**Phase 1: Foundation (1 agent)**

```
WU-0: Shared types and configuration
```

**Phase 2: Generation Scripts (2 agents, parallel)**

```
WU-1: TypeDoc pipeline      (Agent 1)
WU-2: CLAUDE.txt generation (Agent 2)
```

**Phase 3: UI Components (4 agents, parallel)**

```
WU-4: Search integration    (Agent 1)
WU-5: Version selector      (Agent 2)
WU-6: Edit on GitHub        (Agent 3)
WU-7: CI/CD pipeline        (Agent 4)
```

**Phase 4: Pages (1 agent, after Phase 2-3)**

```
WU-3: API reference pages (depends on WU-0, WU-1)
```

**Phase 5: Content (1 agent, after Phase 4)**

```
WU-8: Guides and content migration
```

**Phase 6: Validation (1 agent, after all)**

```
WU-9: Integration testing
```

## Risk Assessment

| Risk                               | Mitigation                                  |
| ---------------------------------- | ------------------------------------------- |
| TypeDoc output format changes      | Pin TypeDoc version, add transform tests    |
| Algolia DocSearch not approved     | Implement FlexSearch fallback (in WU-4)     |
| Generated types drift from source  | CI pipeline regenerates on every change     |
| Version URL conflicts              | Test rewrites thoroughly in WU-5            |
| CLAUDE.txt too long for AI context | Target 200-300 lines, prioritize essentials |

## Implementation Commands

```bash
# Phase 1: Foundation
./scripts/coordinate.sh claim WU-0
@build "Implement WU-0: Shared types and TypeDoc configuration"
./scripts/coordinate.sh complete WU-0

# Phase 2: Generation Scripts (parallel)
Terminal 1: ./scripts/coordinate.sh claim WU-1
Terminal 1: @build "Implement WU-1: TypeDoc API generation pipeline"

Terminal 2: ./scripts/coordinate.sh claim WU-2
Terminal 2: @build "Implement WU-2: CLAUDE.txt auto-generation from TypeScript"

# Phase 3: UI Components (parallel, after Phase 2)
Terminal 1: ./scripts/coordinate.sh claim WU-4
Terminal 1: @build "Implement WU-4: Search integration with Algolia DocSearch"

Terminal 2: ./scripts/coordinate.sh claim WU-5
Terminal 2: @build "Implement WU-5: Version selector component"

Terminal 3: ./scripts/coordinate.sh claim WU-6
Terminal 3: @build "Implement WU-6: Edit on GitHub links"

Terminal 4: ./scripts/coordinate.sh claim WU-7
Terminal 4: @build "Implement WU-7: CI/CD pipeline for documentation"

# Phase 4: Pages (after WU-1 complete)
./scripts/coordinate.sh claim WU-3
@build "Implement WU-3: API reference pages in developers app"

# Phase 5: Content (after WU-3 complete)
./scripts/coordinate.sh claim WU-8
@build "Implement WU-8: Framework guides and content migration"

# Phase 6: Integration (after all complete)
./scripts/coordinate.sh claim WU-9
@build "Implement WU-9: E2E tests for documentation system"
```

## Definition of Done

Each work unit is complete when:

1. **Code complete** - All files in exclusive list created/modified
2. **Tests pass** - Unit/integration tests for the WU pass
3. **Linting clean** - No ESLint/TypeScript errors
4. **Documented** - JSDoc on public functions
5. **Committed** - Single commit with `feat(WU-N):` prefix
6. **Verified** - Manual verification of functionality

## Success Criteria

| Metric            | Target                      |
| ----------------- | --------------------------- |
| CLAUDE.txt lines  | 200+ (up from 79)           |
| API docs coverage | 100% of public exports      |
| Search available  | Yes (Algolia or fallback)   |
| Version selector  | Working with 2+ versions    |
| CI pipeline       | Auto-deploys on SDK changes |
| E2E tests         | All passing                 |
