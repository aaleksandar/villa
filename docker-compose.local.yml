# HYBRID LOCAL DEV: Infrastructure only
# Next.js runs NATIVELY on host (no OOM, instant HMR)
# Docker provides: HTTPS proxy (Caddy)
#
# Usage: pnpm dev:local

services:
  # HTTPS proxy - required for passkeys (WebAuthn needs secure context)
  https-proxy:
    image: caddy:2-alpine
    container_name: villa-https
    ports:
      - "443:443"
    volumes:
      - ./Caddyfile.local:/etc/caddy/Caddyfile:ro
      - caddy_data:/data
      - caddy_config:/config
    extra_hosts:
      - "host.docker.internal:host-gateway"
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "--no-check-certificate", "https://localhost/caddy-health"]
      interval: 5s
      timeout: 3s
      retries: 3
      start_period: 10s
    restart: unless-stopped

volumes:
  caddy_data:
  caddy_config:
