#!/bin/bash
# Pre-commit hook: Verify bun.lock is in sync

set -e

# Skip if no package.json files are staged
if ! git diff --cached --name-only | grep -qE 'package\.json$'; then
  exit 0
fi

echo "üì¶ Checking bun.lock sync..."

# Check if bun.lock is also staged when package.json changes
if ! git diff --cached --name-only | grep -q 'bun.lock'; then
  echo ""
  echo "‚ö†Ô∏è  package.json changed but bun.lock not staged!"
  echo ""
  echo "Run: bun install && git add bun.lock"
  echo ""
  echo "This ensures the lock file stays in sync with dependencies."
  echo "To bypass (not recommended): git commit --no-verify"
  exit 1
fi

# Verify lock file is actually in sync
if ! bun install --frozen-lockfile > /dev/null 2>&1; then
  echo ""
  echo "‚ùå bun.lock is out of sync with package.json files!"
  echo ""
  echo "Run: bun install && git add bun.lock"
  echo ""
  exit 1
fi

echo "‚úÖ Lock file is in sync"
exit 0
